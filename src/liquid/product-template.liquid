<script>
  // console.log({{ product.options | json }});
  let variants = {{ product.variants | json }};

  const variantImages = [];
  {% for variant in product.variants %}
  {% if variant.image.src != blank %} 
  variantImages.push({
    normal: {{ variant.image.src | img_url: '2000x2000' | json }},
    small: {{ variant.image.src | img_url: 'x500' | json }},
    max: {{ variant.image.src | img_url: 'master' | json }}
  });
  {% endif %}
  {% endfor %}


  let images = [];
  {% for image in product.images %}
  images.push({
    normal: {{ image | img_url: '2000x2000' | json }},
    max: {{ image | img_url: 'master' | json }}
  });
  {% endfor %}

  images = images.filter(el => {
    const isVariantImage = variantImages.findIndex(varImg => {
      return (varImg.normal === el.normal && varImg.max === el.max);
    }) > -1;

    return !isVariantImage;
  });

  variants = variants.map((el, i) => {
    const [color = null, size = null] = el.title.split(' / ');
    el['image'] = variantImages.length && variantImages[i];
    el['size'] = size || el.option2 || undefined;
    el['color'] = color || el.option1 || undefined;

    return el;
  });

  let colors = {};
  variants.forEach(el => {
    const colorSlug = el.color && 
      el.color
      .split(' ')
      .join('-')
      .split('(')
      .join('')
      .split(')')
      .join('')
      .split("'")
      .join('')
      .toLowerCase();

    colors[colorSlug] = {
      title: el.color,
      image: el.image
    };
  });

  let sizes = variants.map(el => el.size);
  sizes = sizes.filter((el, i) => sizes.indexOf(el) === i);

  images[images.length] = variantImages.length && variantImages[0];

  window.sizes = sizes;
  window.images = images;
  window.variants = variants;
  window.colors = colors;
</script>